cot_karma
=========


Плагин позволяет реализовать систему рейтингов (репутации) для пользователей на сайте.
Каждый пользователь может повысить/понизить уровень репутации другого пользователя за его действия на сайте!

![alt tag](http://mycotonti.ru/datas/users/1/karma1_1.png)

Это могут быть сообщения на форуме, комментарии, или размещенные страницы. Так-же пользователь получает дополнительное значение репутации за  посещение сайта каждый день.

Выглядит репутация пользователя, как прямоугольник со значением репутации возле имени пользователя. Цвет прямоугольникак может менятся в зависимости от уровня репутации пользователя.

![alt tag](http://mycotonti.ru/datas/users/1/karma2_1.png)

Возможности плагина:

- изменение рейтинга пользователя

- показ репутации на страницах сайта и т.д.

- показ списка пользователей и их голоса в окне.

- комментирование изменения репутации.

- удаление голосов рейтинга администратором. 

- изменение цвета гаджета, в зависимости от значения репутации.

## Установка

1. Скачайте архив и распакуйте его. 
2. Папку Karma с его содержимым залейте на свой сайт в папку plugins.
3. Установите плагин из админ-панели.
4. Зайдите в настройки плагина и установите значения, необходимые вам.
5. Если вы хотите изменинить внешний вид, то в файле karma/js/karma.css находятся css правила оформления окон кармы.
6. Если вы хотите что-то переделать под свой дизайн, то в папке karma/tpl находятся 2 файла, отвечающие за внешний вид. karma.gadget.tpl  - это шаблон гаджета кармы и karma.popup.tpl  - это шаблон всплывающего окна кармы.
7. Установка завершена. Вставьте необходимые теги на своем сайте. см. вкладку теги.

##Теги в шаблонах темы движка

Для вывода гаджета кармы у вас на сайте, вам необходимо вставить теги гаджета в нужном вам месте.

###Для страниц:

{PAGE_OWNER_KARMA} - page.tpl - гаджет

{LIST_ROW_OWNER_KARMA} - page.list.tpl  (В блоке LIST_ROW ) - гаджет

###Для пользователей

{USERS_DETAILS_KARMA} - users.details.tpl- гаджет

{USERS_ROW_KARMA} - users.tpl  (в блоке USERS_ROW ) - гаджет

{USERS_TOP_KARMA} -  users.tpl  (в блоке MAIN) - сортировка по репутации.

###Для форума

{FORUMS_POSTS_ROW_USERKARMA} - forums.posts.tpl (в блоке FORUMS_POSTS_ROW )- гаджет

###Для комментариев

{COMMENTS_ROW_AUTHOR_KARMA} - comments.tpl  (в блоке COMMENTS_ROW )- гаджет

Так как плагин использует функцию движка для определения тега  пользователя, то можно использовать подключение гаджета кармы и в плагинах. Например для плагина pagelist в шаблоне можно прописать:

{PAGE_ROW_OWNER_KARMA} - pagelist.tpl  (В блоке PAGE_ROW ) - гаджет

Для вывода собственного показателя репутации пользователя, можно использовать вызов функции

{PHP|karma_self()} - гаджет

Его можно использовать для вывода репутации в меню пользователя. Функция берет данные пользователя, который находится на сайте.

##Настройка плагина
__Разрешить отдавать голос за одно сообщение более одного раза ?__ 

 если вы поставите НЕТ, то пользователь не сможет изменять репутацию за один и тот-же (к примеру) комментарий.

__В каких секциях форума не выводить репутацию ?__

  тут вам необходимо выбрать секции форума (если вы его используете у себя на сайте.), в которых не будет работать гаджет кармы. Таким образом вы сможете регулировать где и за что можно изменить репутацию. Как пример запрещенной секцией может быть раздел форума, где у вас описаны правила форума или еще что-то. Что не нуждается в оценке.

__Множитель голоса:__

  Рассчитывается как [Уровень репутации пользователя, который изменяет карму] * [Множитель голоса]. 

Т.е.
Если репутация = 4 * множитель = 0.5, то уровень голоса будет = 2  (4*0.5=2)
Если репутация 0, то она автоматически приравнивается к минимальному значению голоса (см. настройки)
Если репутация = 4 * множитель = 0.1, то уровень голоса будет = 0.4 (4*0.1=0.4) и т.д.

Таким образом: Чем выше значение репутации пользователя, который изменяет карму, тем выше будет значение голоса. 

__Максимальное значение голоса:__

 Максимальное значение голоса пользователя. Даже расчитанное значение через множитель голоса, не будет превышать эту цифру.

__Макс. количество записей на странице:__

  количество отображаемых записей голосов пользователей в открывающемся окне.
  
__Через какой промежуток времени можно изменить рейтинг повторно (anti-flood), часов:__

 Установка времени в часах, через которое один и тот-же пользователь, сможет повторно изменить репутацию. Одному и тому-же пользователю. Это поможет исключить накрутки репутации в целом.

__Минимальное количество постов для изменения репутации другим пользователям:__

 Соответственно это показатель участия пользователя в жизни сайта. Тем самым мы ограничиваем накрутки рейтинга. Минимальное количество постов -  это минимальное количество  сообщений пользователя на сайте (комментарии, страницы, посты на форуме), для разрешения изменять репутацию другим пользователям.

__Закрывать окно после изменения рейтинга ?:__

 если включено, то окно изменения репутации автоматически закроется черз 2 сек. после успешного изменения.

__Начисляемый балл за вход на сайт:__

 это значение репутации, которое будет добавлено пользователю при ежедневном посещении сайта. Данная функция работает раз в сутки. Т.е. если пользователь просто будет авторизироваться несколько раз за сутки, то балл добавится только один раз. Следущее добавление, произойдет ровно через сутки во время авторизации или просто нахождения пользователя на сайте. 

__Комментировать изменение репутации?__

 эта настройка включает обязательное комментирование изменения репутации. Данный комментарий виден в списке голосов репутации.

__Разрешить показ в комментариях ?__

 будет ли отображаться гаджет кармы в комментариях.

__Использовать css файл плагина:__

 данная настройка подключает css файл внешнего вида кармы. Если вы хотите использовать свой дизайн, то скопируйте данные из файла plugins/karma/js/karma.css и вставьте в свой основной css файл с вашими правками. И отключите этот пункт.

__Минимальное значение голоса:__

 минимальное значение голоса при изменении репутации. Даже если расщет через множитель дасть меньший показатель.

__Разрешить показ на форуме ?__

 разрешить отображать гаджет кармы в постах форума.

__Разрешить показ на страницах ?__

  разрешить отображать гаджет кармы на страницах и списках страниц.

__Использовать дополнительные поля пользователя?__

 данная функция подключает встроенную функцию движка Cotonti, для получения дополнительных данных пользователя из его профиля. В данной реализации при включении этого пункта, будут отображаться аватары пользователей.

P/S включение данной функции добавляет количество запросов к базе данных.

__Разрешить понижать репутацию, пользователям с отрицательной репутацией ?__

 соответственно если не разрешить, то пользователь с отрицательным значением репутации, не сможет изменять е другим. (Антиместь ;) )

__Цветовые пороги репутации:__

 Тут вам необходимо указать пороги, при которых цвет гаджета кармы будет менять цвет.

__первое значение__ : Уровень репутации, при котором она будет считаться плохой. К примеру поставьте 0 . И гаджеты пользователей, у которых репутация меньше 0 будут красными. (Плохая репутация)  Можете к примеру поставить -1, тогда  репутация меньше -1 будет считаться плохой и будет красной.

__второе значение__: Уровень репутации, при котором она будет считаться хорошей. К примеру поставьте 5. И гаджеты пользователей, у которых репутация больше 5 будут оранжевыми. (Хорошая репутация) 

__третье значение__: Уровень репутации, при котором она будет считаться jочень хорошей. К примеру поставьте 20. И гаджеты пользователей, у которых репутация больше 20 будут зелеными. (Очень хорошая репутация) . 

__Диапозон между плохой репутацией и хорошей__, отображается серым гаджетом. (Репутация новичка.)

Таким образом исходя из примера:

При значении репутации меньше нуля - гаджет красный. 
При значении репутации от 0 до 5 - гаджет будет серым.
При значении репутации от 5 до 20 - гаджет будет оранжевым.
При значении репутации от 20 и выше - гаджет будет зеленым.

P/S Если вы не хотите использовать множитель в расчетах добовляемого голоса и хотите его сделать фиксированным, то поставьте одинаковые значения для Минимального и Максимального значения голоса.  
